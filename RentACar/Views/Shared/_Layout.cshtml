<!DOCTYPE html>
<html lang="zxx">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rentaly - Car Rental Website</title>
    <link rel="icon" href="~/images/icon.png" type="image/png">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="~/css/bootstrap.min.css" rel="stylesheet" />
    <link href="~/css/mdb.min.css" rel="stylesheet" />
    <link href="~/css/plugins.css" rel="stylesheet" />
    <link href="~/css/style.css" rel="stylesheet" />
    <link href="~/css/coloring.css" rel="stylesheet" />
    <link id="colors" href="~/css/colors/scheme-01.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/lightbox2@2/dist/css/lightbox.min.css" rel="stylesheet" />
    <link href="~/css/owl.carousel.min.css" rel="stylesheet" />
    <link href="~/css/owl.theme.default.min.css" rel="stylesheet" />
</head>
<body onload="initialize()" data-auth="@(User.Identity.IsAuthenticated.ToString().ToLower())">
    <div id="wrapper">

        <!-- Page Preloader -->
        <div id="de-preloader"></div>

        <!-- Header -->
        @await Component.InvokeAsync("Header")

        <!-- Main Content -->
        @RenderBody()

        <!-- Back to Top -->
        <a href="~/#" id="back-to-top"></a>

        <!-- Footer -->
        @await Component.InvokeAsync("Footer")
    </div>

    <!-- JS Plugins -->
    <script src="~/js/plugins.js"></script>
    <script src="~/js/designesia.js"></script>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDgiM7ogCAA2Y5pgSk2KXZfxF5S_1jsptA&libraries=places&callback=initPlaces" async defer></script>

    <!-- Lightbox JS -->
    <script src="https://cdn.jsdelivr.net/npm/lightbox2@2/dist/js/lightbox.min.js"></script>

    <!-- Favorites Sync Script -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const isLoggedIn = document.body.getAttribute("data-auth") === "true";

            // Login olunubsa və localStorage favoritləri varsa → DB-yə göndər
            if (isLoggedIn && localStorage.getItem("favoriteCars")) {
                const favorites = JSON.parse(localStorage.getItem("favoriteCars"));
                if (favorites.length > 0) {
                    fetch("/Favorites/SyncFavorites", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(favorites.map(f => f.id))
                    }).then(() => {
                        localStorage.removeItem("favoriteCars");
                    });
                }
            }
        });
    </script>

    @RenderSection("Scripts", required: false)
</body>
</html>
