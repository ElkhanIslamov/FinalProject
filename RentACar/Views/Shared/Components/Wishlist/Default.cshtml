<li style="position:relative;">
    <a href="javascript:void(0);" id="favorites-toggle" class="menu-item" style="display:inline-flex; align-items:center; gap:6px; height:100%;">
        <i class="fa fa-heart" style="color: red;"></i>
        Seçilmişlər
    </a>
    <ul id="favorites-menu-list"
        style="display:none;min-width:250px;background:#fff;color:#000;padding:10px;list-style:none;
                                       box-shadow:0 2px 6px rgba(0,0,0,0.15);border-radius:4px;position:absolute;
                                       right:0;top:100%;z-index:999;">
        <!-- JS ilə dolacaq -->
    </ul>
</li>
<style>
    #favorites-menu-list li {
        padding: 6px 8px;
        border-bottom: 1px solid #ddd;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

        #favorites-menu-list li:hover {
            background-color: lightgreen;
        }

        #favorites-menu-list li img {
            width: 40px;
            height: 25px;
            object-fit: cover;
            border-radius: 3px;
            margin-right: 8px;
        }

        #favorites-menu-list li:last-child {
            border-bottom: none;
        }

    .remove-favorite {
        cursor: pointer;
        color: red;
        font-weight: bold;
        font-size: 16px;
    }

        .remove-favorite:hover {
            color: darkred;
        }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const favoritesKey = "favoriteCars";
        let favorites = JSON.parse(localStorage.getItem(favoritesKey)) || [];

        const favoritesMenu = document.getElementById("favorites-menu-list");
        const favoritesToggle = document.getElementById("favorites-toggle");

        function renderFavoritesDropdown() {
            favoritesMenu.innerHTML = "";
            if (favorites.length === 0) {
                favoritesMenu.innerHTML = "<li>Seçilmiş yoxdur</li>";
                return;
            }

            favorites.forEach(car => {
                favoritesMenu.insertAdjacentHTML("beforeend", `
                    <li>
                        <a href="/Car/Details/${car.id}" style="display:flex;align-items:center;gap:5px;text-decoration:none;color:inherit;">
                            <img src="/images/car/${car.image}" alt="${car.name}" style="width:50px;height:30px;object-fit:cover;" />
                            <span>${car.name}</span>
                        </a>
                         <span class="remove-favorite" data-id="${car.id}" style="cursor:pointer;color:red;">×</span>
                    </li>
                `);
            });

            document.querySelectorAll(".remove-favorite").forEach(btn => {
                btn.addEventListener("click", function () {
                     const id = parseInt(btn.getAttribute("data-id"));
                favorites = favorites.filter(f => f.id !== id);
                localStorage.setItem(favoritesKey, JSON.stringify(favorites));
                renderFavoritesDropdown();
                renderFavoritesPage(); // Seçilmişlər səhifəsi varsa yenilə
                updateHeartIcons();
                });
            });
        }

        if (favoritesToggle) {
            favoritesToggle.addEventListener("click", function (e) {
                e.preventDefault();
                favoritesMenu.style.display = (favoritesMenu.style.display === "block") ? "none" : "block";
            });
        }

        document.addEventListener("click", function (e) {
            if (!favoritesMenu.contains(e.target) && !favoritesToggle.contains(e.target)) {
                favoritesMenu.style.display = "none";
            }
        });

        renderFavoritesDropdown();
         function updateHeartIcons() {
        $(".favorite-icon").each(function () {
            let id = parseInt($(this).data("id"));
            if (favorites.some(f => f.id === id)) $(this).addClass("active");
            else $(this).removeClass("active");
        });
    }

    updateHeartIcons();

    // expose for favorites page
    window.renderFavoritesPage = function() {
        const container = $("#favorites-container");
        if (!container.length) return;

        container.empty();

        if(favorites.length===0){
            container.html("<p>Seçilmiş avtomobil yoxdur.</p>");
            return;
        }

        favorites.forEach(car=>{
            container.append(`
                <div class="col-md-4 favorite-card" data-id="${car.id}">
                    <div class="card">
                        <img src="/images/car/${car.image}" class="card-img-top" alt="${car.name}">
                        <div class="card-body">
                            <h5 class="card-title">${car.name}</h5>
                            <button class="btn btn-danger remove-favorite" data-id="${car.id}">
                                <i class="fa fa-heart active"></i> Seçimdən çıxar
                            </button>
                        </div>
                    </div>
                </div>
            `);
        });

    });
</script>